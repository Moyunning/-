function [ JS ] = jiedian_yingli( ELT,DS,XY,b,l )
%用环绕法求节点应力（包含节点所有单元应力和取平均值）
%ELT   单元定义数组
%DS    单元应力数组
%XY    节点坐标数组
[p,m]=size(XY);
JS=zeros(p,3);
[q,n]=size(ELT);
DSS=DS(:,2:4);
for i=1:p
    gs=0;
    for j=1:q
        for k=2:4
           if  ELT(j,k)==i
               gs=gs+1;
               JS(i,:)=JS(i,:)+DSS(j,:);
           end
        end
    end
    JS(i,:)=JS(i,:)/gs;
end
for i=1:p
    sx=JS(i,1);
    sy=JS(i,2);
    txy=JS(i,3);
    JS(i,4)=0.5*(sx+sy)+sqrt((sx-sy)^2/4+txy^2);
    JS(i,5)=0.5*(sx+sy)-sqrt((sx-sy)^2/4+txy^2);
    JS(i,6)=90-57.296*atan(txy/(sy-JS(i,5)));
end
%Yup
for i=2:l
    JS(i*(b+1),2)=((XY(i*(b+1),3)-XY(i*(b+1)-2,3))*(XY(i*(b+1),3)-XY(i*(b+1)-3,3)))/(((XY(i*(b+1)-1,3)-XY(i*(b+1)-2,3))*(XY(i*(b+1)-1,3)-XY(i*(b+1)-3,3))))*JS(i*(b+1)-1,2)+...
                  ((XY(i*(b+1),3)-XY(i*(b+1)-1,3))*(XY(i*(b+1),3)-XY(i*(b+1)-3,3)))/(((XY(i*(b+1)-2,3)-XY(i*(b+1)-1,3))*(XY(i*(b+1)-2,3)-XY(i*(b+1)-3,3))))*JS(i*(b+1)-2,2)+...
                  ((XY(i*(b+1),3)-XY(i*(b+1)-1,3))*(XY(i*(b+1),3)-XY(i*(b+1)-2,3)))/(((XY(i*(b+1)-3,3)-XY(i*(b+1)-1,3))*(XY(i*(b+1)-3,3)-XY(i*(b+1)-2,3))))*JS(i*(b+1)-3,2);
              
end
%Ydown
for i=2:l
     JS((i-1)*(b+1)+1,2)=((XY((i-1)*(b+1)+1,3)-XY((i-1)*(b+1)+1+2,3))*(XY((i-1)*(b+1)+1,3)-XY((i-1)*(b+1)+1+3,3)))/((XY((i-1)*(b+1)+1+1,3)-XY((i-1)*(b+1)+1+2,3))*(XY((i-1)*(b+1)+1+1,3)-XY((i-1)*(b+1)+1+3,3)))*JS((i-1)*(b+1)+1+1,2)+...
                         ((XY((i-1)*(b+1)+1,3)-XY((i-1)*(b+1)+1+1,3))*(XY((i-1)*(b+1)+1,3)-XY((i-1)*(b+1)+1+3,3)))/((XY((i-1)*(b+1)+1+2,3)-XY((i-1)*(b+1)+1+1,3))*(XY((i-1)*(b+1)+1+2,3)-XY((i-1)*(b+1)+1+3,3)))*JS((i-1)*(b+1)+1+2,2)+...
                         ((XY((i-1)*(b+1)+1,3)-XY((i-1)*(b+1)+1+1,3))*(XY((i-1)*(b+1)+1,3)-XY((i-1)*(b+1)+1+2,3)))/((XY((i-1)*(b+1)+1+3,3)-XY((i-1)*(b+1)+1+1,3))*(XY((i-1)*(b+1)+1+3,3)-XY((i-1)*(b+1)+1+2,3)))*JS((i-1)*(b+1)+1+3,2);
     
end
%Xright
for i=1:(b+1)
     
     JS((b+1)*l+i,1)=((XY((b+1)*l+i,2)-XY((b+1)*l+i-2*(b+1),2))*(XY((b+1)*l+i,2)-XY((b+1)*l+i-3*(b+1),2)))/((XY((b+1)*l+i-1*(b+1),2)-XY((b+1)*l+i-2*(b+1),2))*(XY((b+1)*l+i-1*(b+1),2)-XY((b+1)*l+i-3*(b+1),2)))*JS((b+1)*l+i-1*(b+1),1)+...
                     ((XY((b+1)*l+i,2)-XY((b+1)*l+i-1*(b+1),2))*(XY((b+1)*l+i,2)-XY((b+1)*l+i-3*(b+1),2)))/((XY((b+1)*l+i-2*(b+1),2)-XY((b+1)*l+i-1*(b+1),2))*(XY((b+1)*l+i-2*(b+1),2)-XY((b+1)*l+i-3*(b+1),2)))*JS((b+1)*l+i-2*(b+1),1)+...
                     ((XY((b+1)*l+i,2)-XY((b+1)*l+i-1*(b+1),2))*(XY((b+1)*l+i,2)-XY((b+1)*l+i-2*(b+1),2)))/((XY((b+1)*l+i-3*(b+1),2)-XY((b+1)*l+i-1*(b+1),2))*(XY((b+1)*l+i-3*(b+1),2)-XY((b+1)*l+i-2*(b+1),2)))*JS((b+1)*l+i-3*(b+1),1);
end
%Xlift
for i=1:(b+1)
    
    JS(i,1)=((XY(i,2)-XY(i+2*(b+1),2))*(XY(i,2)-XY(i+3*(b+1),2)))/((XY(i+1*(b+1),2)-XY(i+2*(b+1),2))*(XY(i+1*(b+1),2)-XY(i+3*(b+1),2)))*JS(i+1*(b+1),1)+...
            ((XY(i,2)-XY(i+1*(b+1),2))*(XY(i,2)-XY(i+3*(b+1),2)))/((XY(i+2*(b+1),2)-XY(i+1*(b+1),2))*(XY(i+2*(b+1),2)-XY(i+3*(b+1),2)))*JS(i+2*(b+1),1)+...
            ((XY(i,2)-XY(i+1*(b+1),2))*(XY(i,2)-XY(i+2*(b+1),2)))/((XY(i+3*(b+1),2)-XY(i+1*(b+1),2))*(XY(i+3*(b+1),2)-XY(i+2*(b+1),2)))*JS(i+3*(b+1),1);
end                              
w=1:p;
JS=[w',JS];
       


end

